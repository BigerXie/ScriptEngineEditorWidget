TW.Runtime.Widgets.scriptengineeditor=function(){function f(){var a=c.getProperty("language");try{d=monaco.editor.create(document.getElementById("widget-scriptengineeditor-ParametersMonaco_"+b),{value:"",language:"json",scrollBeyondLastLine:!1,theme:"vs",minimap:{enabled:!1}}),e=monaco.editor.create(document.getElementById("widget-scriptengineeditor-ScriptEngineMonaco_"+b),{value:"",language:a,scrollBeyondLastLine:!1,theme:"vs",minimap:{enabled:!1}})}catch(g){e=d=null,$("#widget-scriptengineeditor-ParametersMonaco_"+
b).css("display","none"),$("#widget-scriptengineeditor-ScriptEngineMonaco_"+b).css("display","none"),$(".widget-scriptengineeditor-ParametersTextArea_"+b).css("display","block"),$(".widget-scriptengineeditor-ScriptEngineTextArea_"+b).css("display","block")}c.addEvents();c.updateEditor()}var d,e,c=this,b=(new Date).getTime()+"_"+Math.floor(1E3*Math.random());this.runtimeProperties=function(){return{needsDataLoadingAndError:!1,supportsAutoResize:!0}};this.renderHtml=function(){return'<div class="widget-content widget-scriptengineeditor widget-scriptengineeditor widget-scriptengineeditor-'+
b+'">  <label class="widget-scriptengineeditor-label">Parameters</label>  <textarea class="widget-scriptengineeditor-ParametersTextArea widget-scriptengineeditor-ParametersTextArea_'+b+'"></textarea>  <div id="widget-scriptengineeditor-ParametersMonaco_'+b+'" class="widget-scriptengineeditor-ParametersMonaco"></div>  <label class="widget-scriptengineeditor-label widget-scriptengineeditor-top10">Result Parameter</label>  <input type="text" class="widget-scriptengineeditor-ResultParameter widget-scriptengineeditor-ResultParameter_'+
b+'"/>  <label class="widget-scriptengineeditor-label widget-scriptengineeditor-top10">Code</label>  <textarea class="widget-scriptengineeditor-ScriptEngineTextArea widget-scriptengineeditor-ScriptEngineTextArea_'+b+'"></textarea>  <div id="widget-scriptengineeditor-ScriptEngineMonaco_'+b+'" class="widget-scriptengineeditor-ScriptEngineMonaco"></div>  <div class="widget-scriptengineeditor-top10" style="text-align:right">\t   <div class="widget-scriptengineeditor-run widget-scriptengineeditor-run_'+
b+'">Run</div>  </div>  <label class="widget-scriptengineeditor-label widget-scriptengineeditor-top10">Result</label>  <input type="text" class="widget-scriptengineeditor-Result widget-scriptengineeditor-Result_'+b+'" readonly/></div>'};this.afterRender=function(){try{if(window.monaco&&monaco.editor)f();else{require.config({paths:{vs:"https://unpkg.com/monaco-editor@latest/min/vs"}});window.MonacoEnvironment={getWorkerUrl:()=>a};var a=URL.createObjectURL(new Blob(["\n          self.MonacoEnvironment = {baseUrl: 'https://unpkg.com/monaco-editor@latest/min/'};\n          importScripts('https://unpkg.com/monaco-editor@latest/min/vs/base/worker/workerMain.js');\n        "],
{type:"text/javascript"}));require(["vs/editor/editor.main"],f)}}catch(g){e=d=null,$("#widget-scriptengineeditor-ParametersMonaco_"+b).css("display","none"),$("#widget-scriptengineeditor-ScriptEngineMonaco_"+b).css("display","none"),$(".widget-scriptengineeditor-ParametersTextArea_"+b).css("display","block"),$(".widget-scriptengineeditor-ScriptEngineTextArea_"+b).css("display","block"),c.addEvents(),c.updateEditor()}};this.serviceInvoked=function(a){};this.updateProperty=function(a){"debugMode"===
a.TargetProperty?this.setProperty(a.TargetProperty,a.RawSinglePropertyValue):"language"===a.TargetProperty?this.setProperty(a.TargetProperty,a.RawSinglePropertyValue):"parameters"===a.TargetProperty?(this.setProperty(a.TargetProperty,a.RawSinglePropertyValue),this.updateEditor()):"resultParameter"===a.TargetProperty?(this.setProperty(a.TargetProperty,a.RawSinglePropertyValue),this.updateEditor()):"code"===a.TargetProperty&&(this.setProperty(a.TargetProperty,a.RawSinglePropertyValue),this.updateEditor())};
this.addEvents=function(){if(d)d.getModel().onDidChangeContent(()=>{try{c.setProperty("parameters",JSON.parse(d.getModel().getValue()))}catch(a){}});else document.getElementsByClassName("widget-scriptengineeditor-ParametersTextArea_"+b)[0].oninput=()=>{try{c.setProperty("parameters",JSON.parse(event.srcElement.value))}catch(a){}},document.getElementsByClassName("widget-scriptengineeditor-ParametersTextArea_"+b)[0].onchange=()=>{try{c.setProperty("parameters",JSON.parse(event.srcElement.value))}catch(a){}};
document.getElementsByClassName("widget-scriptengineeditor-ResultParameter_"+b)[0].oninput=()=>c.setProperty("resultParameter",event.srcElement.value);document.getElementsByClassName("widget-scriptengineeditor-ResultParameter_"+b)[0].onchange=()=>c.setProperty("resultParameter",event.srcElement.value);if(e)e.getModel().onDidChangeContent(()=>c.setProperty("code",e.getModel().getValue()));else document.getElementsByClassName("widget-scriptengineeditor-ScriptEngineTextArea_"+b)[0].oninput=()=>c.setProperty("code",
event.srcElement.value),document.getElementsByClassName("widget-scriptengineeditor-ScriptEngineTextArea_"+b)[0].onchange=()=>c.setProperty("code",event.srcElement.value);document.getElementsByClassName("widget-scriptengineeditor-run_"+b)[0].onclick=()=>{if(!$(".widget-scriptengineeditor-run_"+b).hasClass("widget-scriptengineeditor-run-disabled")){c.setEnabled(!1);var a=new ThingworxInvoker({entityType:"Resources",entityName:"ScriptEngineResource",characteristic:"Services",target:"exec",apiMethod:"POST"});
a.setParameterValue("parameters",c.getProperty("parameters"));a.setParameterValue("resultParameter",c.getProperty("resultParameter"));a.setParameterValue("code",c.getProperty("code"));a.invokeService(function(a){document.getElementsByClassName("widget-scriptengineeditor-Result_"+b)[0].value=JSON.stringify(a.result.rows[0].result.value);c.setEnabled(!0)},function(a,d){document.getElementsByClassName("widget-scriptengineeditor-Result_"+b)[0].value=d.responseText;c.setEnabled(!0)})}}};this.updateEditor=
function(){var a=c.getProperty("parameters"),g=c.getProperty("resultParameter"),f=c.getProperty("code");d?d.getModel().setValue(a):document.getElementsByClassName("widget-scriptengineeditor-ParametersTextArea_"+b)[0].value=a;document.getElementsByClassName("widget-scriptengineeditor-ResultParameter_"+b)[0].value=g;e?e.getModel().setValue(f):document.getElementsByClassName("widget-scriptengineeditor-ScriptEngineTextArea_"+b)[0].value=f};this.setEnabled=function(a){d?d.updateOptions({readOnly:!a}):
document.getElementsByClassName("widget-scriptengineeditor-ParametersTextArea_"+b)[0].disabled=a?"":"disabled";document.getElementsByClassName("widget-scriptengineeditor-ResultParameter_"+b)[0].disabled=a?"":"disabled";e?e.updateOptions({readOnly:!a}):document.getElementsByClassName("widget-scriptengineeditor-ScriptEngineTextArea_"+b)[0].disabled=a?"":"disabled";a?$(".widget-scriptengineeditor-run_"+b).removeClass("widget-scriptengineeditor-run-disabled"):$(".widget-scriptengineeditor-run_"+b).addClass("widget-scriptengineeditor-run-disabled")};
this.beforeDestroy=function(){try{console.log("ScriptEngine Editor -> destroy editors"),TW.log.info("ScriptEngine Editor -> destroy editors"),d&&(d.getModel().dispose(),d.dispose(),d=null),e&&(e.getModel().dispose(),e.dispose(),e=null)}catch(a){TW.log.error("ScriptEngine Editor Before Destroy Error",a)}}};